openapi: 3.0.0
info:
  description: 'This is the FoodAuthent API Description [www.foodauthent.net]'
  version: 1.0.0
  title: FoodAuthent Swagger API
  termsOfService: 'https://www.foodauthent.net/terms/'
  contact:
    email: api@foodauthent.net
  license:
    name: Apache 2.0
    url: 'http://www.apache.org/licenses/LICENSE-2.0.html'

tags:
  - name: sop
    description: All standard operating procedure endpoints.
  - name: product
    description: All product endpoints.
  - name: fingerprint
    description: All fingerprint/sample endpoints.
  - name: workflow
    description: All workflow endpoints.
  - name: model
    description: All model endpoints.
  - name: tag
    description: 'All endpoints to deal with tags, i.e. query, delete, add, ...'
  - name: file
    description: All endpoint that deal with files.
  - name: custom-metadata
    description: Endpoints that deal with custom metadata.

paths:
  /sop:
    get:
      tags:
        - sop
      summary: Finds SOPs by some key words or return all sop's.
      description: >-
        Muliple tags can be provided with comma separated strings. Use keyword1,
        keyword2, keyword3 for testing. If no keyword is specified, all entries
        will be considered.
      operationId: findSOPByKeyword
      parameters:
        - $ref: "#/components/parameters/pageNumber"
        - $ref: "#/components/parameters/pageSize"
        - $ref: "#/components/parameters/keywords"
      responses:
        '200':
          description: successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SOPPageResult'
    post:
      tags:
        - sop
      summary: Creates a new SOP.
      description: TODO
      operationId: createNewSOP
      responses:
        '201':
          description: New sop created with the new sop-id returned.
          content:
            application/json:
              schema:
                type: string
                format: uuid
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SOP'
        description: TODO
        required: true

  '/sop/{sop-id}':
    get:
      tags:
        - sop
      summary: Get the sop an id.
      description: TODO
      operationId: getSOPById
      parameters:
        - name: sop-id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: The SOP.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SOP'
    delete:
      tags:
        - sop
      summary: Delete a sop specified by id.
      description: TODO
      operationId: removeSOPById
      parameters:
        - name: sop-id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: SOP successfully deleted.
  /file:
    post:
      tags:
        - file
      summary: Creates a new file by posting the file metadata first.
      description: TODO
      operationId: createFileMetadata
      responses:
        '201':
          description: >-
            New file metadata object created. Returns its fa-id (i.e. the file
            id)
          content:
            application/json:
              schema:
                type: string
                format: uuid
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/FileMetadata'
        description: The actual metadata object.
        required: true

  '/file/{file-id}':
    get:
      tags:
        - file
      summary: Returns the file metadata.
      description: TODO
      operationId: getFileMetadata
      parameters:
        - name: file-id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: The file metadata.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FileMetadata'

  '/file/{file-id}/data':
    get:
      tags:
        - file
      summary: Let one download the actual file data.
      description: TODO
      operationId: getFileData
      parameters:
        - name: file-id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: The file data.
          content:
            application/binary:
              schema:
                type: string
                format: binary
    put:
      tags:
        - file
      summary: Uploads (and replaces) the actual file-data for the given file id
      description: TODO
      operationId: saveFileData
      parameters:
        - name: file-id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: >-
            File data has been uploaded successfully. Returns the fa-id of the
            file (i.e. file-id)
          content:
            application/json:
              schema:
                type: string
                format: uuid
        #TODO fix response codes!!
        '433':
          $ref: "#/components/responses/InvalidData" 
        '434':
          $ref: "#/components/responses/InvalidInput"
        '500':
          $ref: "#/components/responses/FAException"
      requestBody:
        content:
          multipart/form-data:
            schema:
              $ref: "#/components/schemas/File"

  /fingerprintset:
    get:
      tags:
        - fingerprint
      summary: Finds fingerprint sets by some key words or return all fingerprint sets.
      description: >-
        Muliple tags can be provided with comma separated strings. Use tag1,
        tag2, tag3 for testing.
      operationId: findFingerprintSetByKeyword
      parameters:
        - $ref: "#/components/parameters/pageNumber"
        - $ref: "#/components/parameters/pageSize"
        - $ref: "#/components/parameters/keywords"
      responses:
        '200':
          description: successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FingerprintSetPageResult'
    post:
      tags:
        - fingerprint
      summary: Create a new fingerprint set.
      description: TODO
      operationId: createFingerprintSet
      responses:
        '201':
          description: >-
            The new id of the fingerprint set in the fa-system (fingerprint-set
            id)
          content:
            application/json:
              schema:
                type: string
                format: uuid
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/FingerprintSet'
        description: A fingerprint set containing fingerprint metadata.
        required: true

  '/fingerprintset/{fingerprintset-id}':
    get:
      tags:
        - fingerprint
      summary: Get the fingerprintset by id.
      description: TODO
      operationId: getFingerprintSetById
      parameters:
        - name: fingerprintset-id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: The fingerprint set.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FingerprintSet'

  /product:
    get:
      tags:
        - product
      summary: Finds Products by some key words or return all Products.
      description: >-
        Muliple tags can be provided with comma separated strings. Use tag1,
        tag2, tag3 for testing.
      operationId: findProductByKeyword
      parameters:
        - $ref: "#/components/parameters/pageNumber"
        - $ref: "#/components/parameters/pageSize"
        - $ref: "#/components/parameters/keywords"
      responses:
        '200':
          description: successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProductPageResult'
    post:
      tags:
        - product
      summary: Create a new product entity.
      description: TODO
      operationId: createProduct
      responses:
        '201':
          description: >-
            Product has been created successfully and the new fa-id of the
            product is returned.
          content:
            application/json:
              schema:
                type: string
                format: uuid
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Product'
        description: TODO

  /product/findByGtin:
    get:
      tags:
        - product
      summary: Find product by gtin.
      description: TODO
      operationId: findProductByGtin
      parameters:
        - in: query
          name: gtin
          description: TODO
          required: true
          schema:
            type: string
      responses:
        '200':
          description: The found product.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Product'
        '404':
          description: TODO, add response reference

  /prediction:
    get:
      tags:
        - workflow
      summary: Finds Prediction by some key words or return all Predictions.
      description: >-
        Muliple tags can be provided with comma separated strings. Use tag1,
        tag2, tag3 for testing.
      operationId: findModelByKeyword
      parameters:
        - $ref: "#/components/parameters/pageNumber"
        - $ref: "#/components/parameters/pageSize"
        - $ref: "#/components/parameters/keywords"
      responses:
        '200':
          description: successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PredictionPageResult'

  '/prediction/{prediction-id}':
    get:
      tags:
        - workflow
      summary: Get a specific prediction result.
      operationId: getPredictionResult
      parameters:
        - in: path
          name: prediction-id
          description: TODO
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: List of predictions.
          content:
            application/json: 
              schema:
                $ref: '#/components/schemas/Prediction'
  /model:
    get:
      tags:
        - model
      summary: Finds Models by some key words or return all Models.
      description: >-
        Muliple tags can be provided with comma separated strings. Use tag1,
        tag2, tag3 for testing.
      operationId: findModelByKeyword
      parameters:
        - $ref: "#/components/parameters/pageNumber"
        - $ref: "#/components/parameters/pageSize"
        - $ref: "#/components/parameters/keywords"
      responses:
        '200':
          description: successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ModelPageResult'
    post:
      tags:
        - model
      summary: Creates/adds a new model.
      description: Creates/adds a new model.
      operationId: createModel
      responses:
        '201':
          description: >-
            Model has been created successfully and the new fa-id of the model
            (model-id) is returned.
          content:
            application/json:
              schema:
                type: string
                format: uuid
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Model'
        description: TODO

  '/model/{model-id}':
    get:
      tags:
        - model
      summary: Get the model by id.
      description: TODO
      operationId: getModelById
      parameters:
        - name: model-id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: The model.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Model'

  /workflow:
    get:
      tags:
        - workflow
      summary: Finds Workflow by some key words or return all Workflows.
      description: >-
        Muliple tags can be provided with comma separated strings. Use tag1,
        tag2, tag3 for testing.
      operationId: findWorkflowByKeyword
      parameters:
        - $ref: "#/components/parameters/pageNumber"
        - $ref: "#/components/parameters/pageSize"
        - $ref: "#/components/parameters/keywords"
      responses:
        '200':
          description: successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WorkflowPageResult'
    post:
      tags:
        - workflow
      summary: Creates/adds a new workflow.
      description: Creates/adds a new workflow.
      operationId: createWorkflow
      responses:
        '201':
          description: >-
            Workflow has been created successfully and the new fa-id of the
            workflow is returned.
          content:
            application/json:
              schema:
                type: string
                format: uuid
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Workflow'
        description: TODO

  '/workflow/{workflow-id}':
    get:
      tags:
        - workflow
      summary: Get the workflow an id.
      description: TODO
      operationId: getWorkflowById
      parameters:
        - name: workflow-id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: The workflow.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Workflow'

  /workflow/training:
    get:
      tags:
        - workflow
      summary: >-
        Finds workflows by some key words or return all workflows suitable for
        training models.
      description: >-
        Muliple tags can be provided with comma separated strings. Use tag1,
        tag2, tag3 for testing.
      operationId: findTrainingWorkflows
      parameters:
        - $ref: "#/components/parameters/pageNumber"
        - $ref: "#/components/parameters/pageSize"
        - $ref: "#/components/parameters/keywords"
      responses:
        '200':
          description: successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WorkflowPageResult'

  /workflow/training/job:
    get:
      tags:
        - workflow
      summary: Finds training jobs by some key words or return all training jobs.
      description: >-
        Muliple tags can be provided with comma separated strings. Use tag1,
        tag2, tag3 for testing.
      operationId: findTrainingJobs
      parameters:
        - $ref: "#/components/parameters/pageNumber"
        - $ref: "#/components/parameters/pageSize"
        - $ref: "#/components/parameters/keywords"
      responses:
        '200':
          description: successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TrainingJobPageResult'
    post:
      tags:
        - workflow
      summary: Starts creating a model for a set of fingerprints.
      operationId: createTrainingJob
      parameters:
        - in: query
          name: workflow-id
          description: TODO
          required: true
          schema:
            type: string
            format: uuid
        - in: query
          name: fingerprintset-id
          description: TODO
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '201':
          description: The model training job as been created successfully.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TrainingJob'
        '500':
          $ref: "#/components/responses/InitJobFailed"

  '/workflow/training/job/{job-id}':
    get:
      tags:
        - workflow
      summary: Lets one to ask for the status of a particular job.
      operationId: getTrainingJob
      parameters:
        - in: path
          name: job-id
          description: TODO
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: The training job.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TrainingJob'

  /workflow/prediction:
    get:
      tags:
        - workflow
      summary: >-
        Finds workflows by some key words or return all workflows suitable for
        prediction.
      description: >-
        Muliple tags can be provided with comma separated strings. Use tag1,
        tag2, tag3 for testing.
      operationId: findPredictionWorkflows
      parameters:
        - $ref: "#/components/parameters/pageNumber"
        - $ref: "#/components/parameters/pageSize"
        - $ref: "#/components/parameters/keywords"
      responses:
        '200':
          description: successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WorkflowPageResult'

  /workflow/prediction/job:
    get:
      tags:
        - workflow
      summary: >-
        Finds predictions jobs by some key words or return all predictions jobs
        suitable for prediction.
      description: >-
        Muliple tags can be provided with comma separated strings. Use tag1,
        tag2, tag3 for testing.
      operationId: findPredictionJobs
      parameters:
        - $ref: "#/components/parameters/pageNumber"
        - $ref: "#/components/parameters/pageSize"
        - $ref: "#/components/parameters/keywords"
      responses:
        '200':
          description: successful operation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PredictionJobPageResult'
    post:
      tags:
        - workflow
      summary: Starts a prediction for a fingerprint.
      operationId: createPredictionJob
      parameters:
        - in: query
          name: workflow-id
          description: TODO
          required: true
          schema:
            type: string
            format: uuid
        - in: query
          name: fingerprintset-id
          description: TODO
          required: true
          schema:
            type: string
            format: uuid
        - in: query
          name: model-id
          description: >-
            The model to be used for prediction. Needs to be compatible with the
            selected workflow!!
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: The prediction job.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PredictionJob'
        '500':
          $ref: "#/components/responses/InitJobFailed"

  '/workflow/prediction/job/{job-id}':
    get:
      tags:
        - workflow
      summary: Lets one to ask for the status of a particular job.
      operationId: getPredictionJob
      parameters:
        - in: path
          name: job-id
          description: TODO
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: The prediction job.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PredictionJob'
                
  '/custommetadata/{model-id}':
    get:
      tags:
        - custom-metadata
      summary: Returns all available schema ids for a model id.
      description: >-
        TODO
      operationId: getCustomMetadataSchemas
      parameters:
        - $ref: "#/components/parameters/model-id"
      responses:
        '200':
          description: The list of schema-ids available for this type of entity.
          content:
            application/json:
              schema:
                type: array
                items:
                  type: string
                
  '/custommetadata/{model-id}/{schema-id}':
    get:
      tags:
        - custom-metadata
      summary: Returns the json-schema for a given schema- and model-id.
      description: >-
        TODO
      operationId: getCustomMetadataSchema
      parameters:
        - $ref: "#/components/parameters/model-id"
        - $ref: "#/components/parameters/schema-id"
      responses:
        '200':
          description: TODO
          content:
            application/schema+json:
              schema:
                type: string 
                
  '/custommetadata/{model-id}/{schema-id}/{fa-id}':
    get:
      tags:
        - custom-metadata
      summary: Returns the custom metadata for a specific model, schema and model-instance.
      description: >-
        TODO
      operationId: getCustomMetadata
      parameters:
        - $ref: "#/components/parameters/model-id"
        - $ref: "#/components/parameters/schema-id"
        - in: path
          name: fa-id
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: TODO
          content:
            application/json:
              schema:
                type: string 
    post:
      tags:
        - custom-metadata
      summary: Adds custom metadata for a specific model, schema and model-instance.
      description: >-
        TODO
      operationId: saveCustomMetadata
      parameters:
        - $ref: "#/components/parameters/model-id"
        - $ref: "#/components/parameters/schema-id"
        - in: path
          name: fa-id
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '201':
          description: Custom metadata successfully added
      requestBody:
        content:
          application/json:
            schema:
              description: The object representing the custom metadata for a model with the given fa-id.
              type: string
                
servers:
  - url: /v0/foodauthent

components:
  parameters:
    pageNumber:
      description: the page number starting at 0
      name: pageNumber
      in: query
      schema:
        type: integer
    pageSize: 
      description: entries per page, minimum 1
      name: pageSize
      in: query
      schema:
        type: integer
    keywords:
      name: keywords
      in: query
      description: Keywords to search for
      required: false
      explode: true
      schema:
        type: array
        items:
         type: string
    model-id:
      name: model-id
      in: path
      required: true
      schema:
        enum:
          - product
          - fingerprintset
          - sop
    schema-id:
      name: schema-id
      in: path
      required: true
      schema:
        type: string

  responses:
    FAException:
      description: Unspecified exception.
      x-fa-exceptions:
        - name: FAException
    InvalidInput:
      description: Invalid input was provided.
      x-fa-exceptions:
        - name: InvalidInputException
    InitJobFailed:
      description: Exception thrown when a job could not be initialized.
      x-fa-exceptions:
        - name: InitJobException
    InvalidData:
      description: Invalid data was uploaded.
      x-fa-exceptions:
        - name: InvalidDataException
  
  schemas:
    SOPPageResult:
      type: object
      x-no-faid: true
      properties:
        pageNumber:
          type: integer
        pageCount:
          type: integer
        resultCount:
          type: integer
        results:
          type: array
          items:
            $ref: '#/components/schemas/SOP'

    SOP:
      type: object
      x-ui-vue.js:
        - name: file-id
          id-provider: upload-file
        - name: name
        - name: description
        - name: product-id
          id-provider: select-product
      properties:
        fa-id:
          description: A global id within the FoodAuthent-system.
          type: string
          format: uuid
          example: ''
        file-id:
          description: Id referencing the file in the fa-system.
          type: string
          format: uuid
        name:
          description: A short SOP name
          type: string
        description:
          description: A short description of the sop
          type: string
        product-id:
          description: A reference to a product this sop is made for.
          type: string
          format: uuid
          example: ''

    FileMetadata:
      description: Metadata of a file in the FoodAuthent-system.
      type: object
      x-ui-vue.js:
        - name: type
        - name: name
        - name: author
      properties:
        fa-id:
          description: A global id within the FoodAuthent-system.
          type: string
          format: uuid
          example: ''
        type:
          description: The file type.
          type: string
          enum:
            - knime_workflow
            - knime_model
            - python_script
            - sop_pdf
            - fingerprints_bruker
        name:
          description: A name for the file.
          type: string
        uploadName:
          description: >-
            The name of the file as uploaded. Will be set automatically if left
            empty and a file is uploaded for the first time.
          type: string
        description:
          description: A more verbose description of the file.
          type: string
        author:
          description: The authors name (TODO - could reference a user in the future).
          type: string
        date:
          description: The creation date.
          type: string
          format: date
        uploadDate:
          description: Time and date of the file upload. Will be set automatically.
          type: string
          format: date
        version:
          description: The file's version.
          type: integer
        additional-properties:
          description: Key-value-map for additional properties.
          #string to string map
          type: object
          additionalProperties:
            type: string
          
    File:
      description: A file, e.g. to be uploaded
      type: object
      properties:
        filedata:
          description: The binary file data.
          type: string
          format: binary
      required:
        - filedata

    # should always be part of a fingerprint set
    Fingerprint:
      description: A fingerprint object representing its metadata.
      type: object
      x-ui-vue.js:
        - name: metadata
      properties:
        fa-id:
          description: A global id within the FoodAuthent-system.
          type: string
          format: uuid
          example: ''
        metadata:
          description: Placeholder for the actual metadata.
          type: string

    FingerprintSetPageResult:
      type: object
      x-no-faid: true
      properties:
        pageNumber:
          type: integer
        pageCount:
          type: integer
        resultCount:
          type: integer
        results:
          type: array
          items:
            $ref: '#/components/schemas/FingerprintSet'

    FingerprintSet:
      description: A set of fingerprints with its own id.
      type: object
      required:
        - file-id
        - product-id
      x-ui-vue.js:
        - name: product-id
          id-provider: select-product
        - name: fingerprints
        - name: file-id
          id-provider: upload-file
        - name: name
        - name: metadata
      properties:
        fa-id:
          description: A global id within the FoodAuthent-system.
          type: string
          format: uuid
          example: ''
        product-id:
          description: The fa-id of the product all fingerprints are associated with.
          type: string
          format: uuid
          example: ''
        fingerprints:
          description: The fingerprints.
          type: array
          items:
            $ref: '#/components/schemas/Fingerprint'
        file-id:
          description: Id referencing the fingerpint-set file.
          type: string
          format: uuid
        name:
          description: A human-readable name of the fingerprint set.
          type: string
        metadata:
          description: >-
            Placeholder for more (fixed) metadata (including device settings
            etc.). Possibly automatically determined upon creation of the
            fingerprint-set.
          type: string
        additional-properties:
          description: Key-value-map for additional properties.
          type: object
          additionalProperties:
            type: string

    ModelPageResult:
      type: object
      x-no-faid: true
      properties:
        pageNumber:
          type: integer
        pageCount:
          type: integer
        resultCount:
          type: integer
        results:
          type: array
          items:
            $ref: '#/components/schemas/Model'

    Model:
      description: >-
        A model created via training and used for prediction. Can also be a
        workflow.
      type: object
      x-ui-vue.js:
        - name: name
        - name: description
        - name: author
        - name: version
        - name: type
        - name: tags
        - name: file-id
          id-provider: upload-file
        - name: product-id
          id-provider: select-product
      properties:
        fa-id:
          description: A global id within the FoodAuthent-system.
          type: string
          format: uuid
          example: ''
        name:
          description: A name for the model.
          type: string
        description:
          description: A more verbose description of the model.
          type: string
        author:
          description: The authors name (TODO - could reference a user in the future).
          type: string
        date:
          description: The creation date.
          type: string
          format: date
        version:
          description: The model's version.
          type: integer
        type:
          #TODO allow custom types that are not predefined
          description: >-
            The type of the model in order to be able to check for compatibility
            of the workflows using it.
          type: string
          # must be kept in sync with workflow.model-type
          enum:
            - knime_workflow
            - knime_python
            - pmml
        tags:
          description: Descriptive tags/annotations for the model.
          type: array
          items:
            $ref: '#/components/schemas/Tag'
        file-id:
          description: id referencing the model file.
          type: string
          format: uuid
        product-id:
          description: Reference to the product this model has been trained for.
          type: string
          format: uuid
        workflow-id:
          description: Optional reference to the workflow used to create this model.
          type: string
          format: uuid
          
    ProductPageResult:
      type: object
      x-no-faid: true
      properties:
        pageNumber:
          type: integer
        pageCount:
          type: integer
        resultCount:
          type: integer
        results:
          type: array
          items:
            $ref: '#/components/schemas/Product'

    Product:
      description: >-
        Global product metadata, e.g., country of origin, etc. There can be
        multiple fingerprints for one product.
      type: object
      x-ui-vue.js:
        - name: gtin
        - name: brand
      properties:
        fa-id:
          description: A global id within the FoodAuthent-system.
          type: string
          format: uuid
          example: ''
        gtin:
          type: string
        brand:
          type: string

    PredictionJobPageResult:
      type: object
      x-no-faid: true
      properties:
        pageNumber:
          type: integer
        pageCount:
          type: integer
        resultCount:
          type: integer
        results:
          type: array
          items:
            $ref: '#/components/schemas/PredictionJob'

    PredictionJob:
      description: Represents prediction job.
      type: object
      properties:
        fa-id:
          description: A global id within the FoodAuthent-system.
          type: string
          format: uuid
          example: ''
        prediction-id:
          description: >-
            The id of the prediction result if the job has completed
            successfully.
          type: string
          format: uuid
          example: ''
        status:
          description: The current status of the prediction job.
          type: string
          enum:
            - running
            - success
            - failed
        status-message:
          description: 'A message, e.g., in case the workflow failed.'
          type: string

    PredictionPageResult:
      type: object
      x-no-faid: true
      properties:
        pageNumber:
          type: integer
        pageCount:
          type: integer
        resultCount:
          type: integer
        results:
          type: array
          items:
            $ref: '#/components/schemas/Prediction'

    #predictions per fingerprint set!!
    Prediction:
      type: object
      x-ui-vue.js:
        - name: workflow-id
          id-provider: select-workflow
        - name: fingerprint-set-id
          id-provider: select-fingerprint
        - name: model-id
          id-provider: select-model
      properties:
        fa-id:
          description: A global id within the FoodAuthent-system.
          type: string
          format: uuid
          example: ''
        confidence-map:
          description: >-
            The confidences for each fingerprint, mapped from the
            fingerprint-id.
          type: object
          #map from fa-id to confidence
          additionalProperties:
            type: number
            format: float
            maximum: 1
            minimum: 0
        workflow-id:
          description: Workflow used for the prediction.
          type: string
          format: uuid
          example: ''
        fingerprint-set-id:
          description: Id of the set the prediction has been done for.
          type: string
          format: uuid
          example: ''
        model-id:
          description: The model that has been used for the prediction.
          type: string
          format: uuid
          example: ''

    TrainingJobPageResult:
      type: object
      x-no-faid: true
      properties:
        pageNumber:
          type: integer
        pageCount:
          type: integer
        resultCount:
          type: integer
        results:
          type: array
          items:
            $ref: '#/components/schemas/TrainingJob'

    TrainingJob:
      description: Represents model training job.
      type: object
      properties:
        fa-id:
          description: A global id within the FoodAuthent-system.
          type: string
          format: uuid
          example: ''
        model-id:
          description: The created model after successful training.
          type: string
          format: uuid
          example: ''
        status:
          type: string
          enum:
            - running
            - success
            - failed
        status-message:
          description: 'A message, e.g., in case the workflow failed.'
          type: string

    TagPageResult:
      type: object
      x-no-faid: true
      properties:
        pageNumber:
          type: integer
        pageCount:
          type: integer
        resultCount:
          type: integer
        results:
          type: array
          items:
            $ref: '#/components/schemas/Tag'

    Tag:
      description: A tag/label for objects.
      type: object
      x-ui-vue.js:
        - name: name
        - name: description
      properties:
        fa-id:
          description: A global id within the FoodAuthent-system.
          type: string
          format: uuid
          example: ''
        name:
          description: A human-readable name
          type: string
        description:
          description: A more verbose description.
          type: string
        type:
          description: >-
            The type of the tag, e.g. whether it's a tag for a workflow, a model
            or a fingerprint.
          type: string
          enum:
            - workflow
            - model
            - fingerprint
            - sop

    WorkflowPageResult:
      type: object
      x-no-faid: true
      properties:
        pageNumber:
          type: integer
        pageCount:
          type: integer
        resultCount:
          type: integer
        results:
          type: array
          items:
            $ref: '#/components/schemas/Workflow'

    Workflow:
      type: object
      description: A workflow for a certain task.
      required:
        - type
        - file-id
        - name
        - representation
      x-ui-vue.js:
        - name: name
        - name: description
        - name: type
        - name: parameters
        - name: tags
      properties:
        fa-id:
          description: A global id within the FoodAuthent-system.
          type: string
          format: uuid
          example: ''
        name:
          type: string
        description:
          type: string
        representation:
          description: >-
            The workflow representation, e.g. represented by a scripting
            language, cwl or a KNIME-workflow.
          type: string
          enum:
            - cwl
            - r
            - python
            - knime
        type:
          #TODO allow custom types that are not predefined
          description: >-
            The type of the workflow.  IMPORTANT: This property determines the
            required workflow input and output, e.g., PredictionWorkflowInput
            and PredicitonWorkflowOutput-entity.
          type: string
          #TODO another potential type: preprocessing workflow
          enum:
            - prediction_workflow
            - training_workflow
        parameters:
          description: 'The parameters of the workflow, TODO - should maybe be a map.'
          type: array
          items:
            $ref: '#/components/schemas/WorkflowParameter'
        tags:
          description: Descriptive tags/annotations for the workflow.
          type: array
          items:
            $ref: '#/components/schemas/Tag'
        file-id:
          description: id referencing the workflow file.
          type: string
          format: uuid
        model-type:
          description: >-
            Type of the model this workflow can consume or produce. Can be left
            empty, e.g., in case of a preprocessing workflow. Model type must
            match one of the model's type property.
          type: string
          # must be kept in sync with model.type
          enum:
            - knime_workflow
            - knime_python
            - pmml

    WorkflowParameter:
      type: object
      description: Represents a workflow parameter.
      x-no-faid: true
      x-ui-vue.js:
        - name: name
        - name: required
        - name: type
        - name: value
      properties:
        name:
          description: the parameter name
          type: string
        required:
          description: whether the parameter is required
          type: boolean
        type:
          description: the parameter type
          type: string
          enum:
            - string
            - number
        value:
          description: the parameter value
          type: string
          

    # Inputs and outputs for different workflow types (see type-property of the workflow entity).
    # Not used by any endpoint but as entity directly!
    # Changes here might cause (test) workflows to not work anymore.

    PredictionWorkflowInput:
      description: Describes the input required by a prediction workflow.
      type: object
      x-no-faid: true
      properties:
        parameters:
          description: The workflow parameters as given provided by the Workflow-entity.
          type: array
          items:
            $ref: '#/components/schemas/WorkflowParameter'
        fingerprintset-metadata:
          $ref: '#/components/schemas/FingerprintSet'
        fingerprintset-URI:
          description: >-
            URI pointing to the resource containg the fingerprints to predict
            the labels for.
          type: string
          format: uri
        model-URI:
          description: >-
            optional model uri (if required by the workflow) pointing to the
            model to use
          type: string
          format: uri

    PredictionWorkflowOutput:
      description: Describes the outputs delivered by a prediction workflow.
      type: object
      x-no-faid: true
      properties:
        confidence-map:
          description: >-
            The confidences for each fingerprint, mapped from the
            fingerprint-id.
          type: object
          #map from fa-id to confidence
          additionalProperties:
            type: number
            format: float
            maximum: 1
            minimum: 0

    TrainingWorkflowInput:
      description: Describes the input required by a training workflow.
      type: object
      x-no-faid: true
      properties:
        parameters:
          description: The workflow parameters as given provided by the Workflow-entity.
          type: array
          items:
            $ref: '#/components/schemas/WorkflowParameter'
        fingerprintset-metadata:
          $ref: '#/components/schemas/FingerprintSet'
        fingerprintset-URI:
          description: >-
            URI pointing to the resource containg the fingerprints to learn the
            model from.
          type: string
          format: uri

    TrainingWorkflowOutput:
      description: Describes the outputs delivered by a training workflow.
      type: object
      x-no-faid: true
      properties:
        model-uri:
          description: URI pointing to the created model file.
          type: string
          format: uri
